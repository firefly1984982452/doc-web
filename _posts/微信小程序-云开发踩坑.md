---
title: 微信小程序-云开发踩坑
date: 2019-01-16 16:15:18
categories: 
- program
---


# 数据库

如果要导入数据时，不是一般的json格式，是以下格式：

```
{}
{}
{}
{}
```
**没有逗号，外面也不用数组包起来**


## 查
```
const db = wx.cloud.database()
db.collection('app').limit(5).where({
    tag: 'JavaScript'
}).get({
    success: function(res){
    that.setData({
        list : res.data
    })
    }
})
```

## 增
```
const db = wx.cloud.database()
db.collection('app').add({
    data: {
    'name': '1'
    },
    success(res) {
    console.log(res)
    },
    fail(err) {
    console.log(err)
    }
})
```
## 改
```
const db = wx.cloud.database()
db.collection('app').doc(_id).update({
    data: {
        agreen: 1
    },
    success(res) {
        console.log(res)
    },
    fail(err) {
        console.log(err)
    }
})
```

## 删
```
const db = wx.cloud.database()
db.collection('app').doc(_id).remove()
```


# 云函数
就是对数据库进行操作，以及其他后台操作
require的文件如果没有一定要先npm install下载

## 定义
```
exports.main = async (event, context) => {
  try {
    return await 'heollo'
  } catch (e) {
  }
}
```

## 调用

调用之前要先上传

```
wx.cloud.callFunction({
    name: 'name',
    success: res => {
        ...
    }
})
```